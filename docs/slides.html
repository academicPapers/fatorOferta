<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Fator Oferta</title>
    <meta charset="utf-8" />
    <meta name="author" content="Luiz Fernando Palin Droubi" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
    <script src="libs/xaringanExtra-progressBar/progress-bar.js"></script>
    <script src="libs/mark.js/mark.min.js"></script>
    <link href="libs/xaringanExtra-search/search.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-search/search.js"></script>
    <script>window.addEventListener('load', function() { window.xeSearch = new RemarkSearch({"position":"bottom-left","caseSensitive":false,"showIcon":true,"autoSearch":true}) })</script>
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <link rel="stylesheet" href="scrollable.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Fator Oferta
## Contextualização, Conceitos e Paradigmas, Estado da Arte e Aplicações
### Luiz Fernando Palin Droubi
### Diretor Técnico da SOBREA
### 27 de junho de 2021

---







class: inverse, center, middle

# Contextualização

<style>.xe__progress-bar__container {
  top:0;
  opacity: 1;
  position:absolute;
  right:0;
  left: 0;
}
.xe__progress-bar {
  height: 0.25em;
  background-color: #0051BA;
  width: calc(var(--slide-current) / var(--slide-total) * 100%);
}
.remark-visible .xe__progress-bar {
  animation: xe__progress-bar__wipe 200ms forwards;
  animation-timing-function: cubic-bezier(.86,0,.07,1);
}
@keyframes xe__progress-bar__wipe {
  0% { width: calc(var(--slide-previous) / var(--slide-total) * 100%); }
  100% { width: calc(var(--slide-current) / var(--slide-total) * 100%); }
}</style>

<div>
<style type="text/css">.xaringan-extra-logo {
width: 110px;
height: 128px;
z-index: 0;
background-image: url(https://sobrea.org.br/wp-content/uploads/elementor/thumbs/Logo-SOBREA-Facebook-Redondo-512x512-1-p6rqwuzy75km0rog7cducjs0umjma86c1yl75qi0ts.png);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
top:1em;right:1em;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide):not(.inverse):not(.hide_logo)')
        .forEach(function (slide) {
          const logo = document.createElement('a')
          logo.classList = 'xaringan-extra-logo'
          logo.href = 'https://sobrea.org.br/'
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div>






---
# Contextualização

## Dados de transação:

--

* Proxy para o valor de mercado
  
--

  - **Se** tratarem-se de *arms' lenght transactions*, ou seja, se as transações
  forem entre partes independentes.
  
--

  - Transações com valores muito discrepantes podem ser de vendas ocorridas em 
  situações diferentes das que caracterizam as *arm's lenght transactions*

--

## Dados de oferta:

--

* Proxy para o valor de mercado
  
--

  - **Se** os anúncios forem *validados*
  
--

  - Necessidade de um passo a mais: a qual distância do valor de mercado 
  encontram-se os dados de oferta?

---
class: inverse, center, middle

# Conceitos e Paradigmas

---
# Conceitos e Paradigmas

## Definições neoclássicas do **VM**:

--

* Preços de mercado vs. Valor de Mercado (**VM**)

--

  - O preço de mercado é o valor efetivamente pago em uma determinada transação, 
enquanto **valor de mercado é um preço de venda hipotético ou estimado** que 
resultaria da consideração cuidadosa pelo comprador e vendedor de todos os dados, 
com confiança nos dados que refletem as ações de compradores e vendedores 
responsáveis e prudentes, sob condições de uma venda justa &lt;a name=cite-spinney&gt;&lt;/a&gt;([Spinney, 2010](#bib-spinney)).

--

  - IVSC: o **valor de mercado é a quantia estimada** pela qual uma propriedade 
  deve ser negociada, na data de avaliação, entre um promitente comprador e um 
  promitente vendedor, entre partes independentes, após um tempo adequado de 
  exposição ao mercado, em que ambas as partes ajam com conhecimento,
  prudência e sem compulsão (French, 2006, p. 87).

--

  - **Valor de mercado é a quantia mais provável** pela qual se negociaria
  voluntariamente e conscientemente um bem, em uma data de referência, dentro
  das condições do mercado vigente &lt;a name=cite-NBR1465301&gt;&lt;/a&gt;([ABNT, 2019](#bib-NBR1465301)).
  
---
# Conceitos e Paradigmas

## Valor mais provável vs. valor mais alto

* Alguns autores entendem que o valor de mercado é o valor mais alto da 
distribuição de probabilidades &lt;a name=cite-mooya2009&gt;&lt;/a&gt;([Mooya, 2009](#bib-mooya2009)):

--

  - **Tome-se o exemplo de uma única propriedade colocada no mercado. Esta 
  propriedade atrairá uma distribuição de ofertas normal de potenciais 
  compradores**. O preço mais alto estará na extremidade superior da 
  distribuição, enquanto o preço mais provável, em termos estatísticos, estará
  em seu centro.

--

  - Levando em contra que os preços reais de mercado são usados como *proxies*
  para o valor de mercado, a questão que se coloca é em que ponto da distribuição
  a propriedade será negociada. Na prática, **um vendedor buscará a maior oferta**
  possível que ele esteja ciente. 

--

  - **Nestas circunstâncias, a propriedade será negociada próximo à extremidade
  superior da distribuição, não na média ou na moda da distribução**. De fato,
  assumindo que os vendedores são 'racionais', todos as vendas observadas 
  serão ao maior valor possível de ser obtido. Isto leva muitos avaliadores a 
  definir o **valor de mercado como o máximo preço possível**.

---
# Conceitos e Paradigmas

## Valor mais provável vs. valor mais alto

* Porém, isto vai de encontro ao senso comum e à intuição:

--

  - Definir o valor de mercado em termos da extremidade superior de uma
  distribuição normal está, no entanto, em desacordo com a maioria das
  definições e com a intuição. **Quanto mais próximo se chega da extremidade
  superior da distribuição, mais se chega próximo a negociações atípicas ou
  especiais** e, portanto, menos representativas do sentimento do mercado o
  preço de venda se torna.

--

  - **A maioria das definições de valor de mercado assumem compradores e 
  vendedores típicos**. Intuitivamente, a maior parte das pessoas não 
  reconheceria compras especiais (ou vendas forçadas) como boas evidências do 
  valor de mercado.

--

  - **O senso comum requer que o valor de mercado seja 'representativo'** do 
mercado em questão e deva, então, se localizar **no centro da distribuição**.
Avaliadores que concordam com esta visão definem o valor de mercado com o valor
mais provável.

---
# Conceitos e Paradigmas

## Valor mais provável vs. valor mais alto

### Como conciliar as duas definições de valor de mercado?

--

* Segundo [Mooya (2009)](#bib-mooya2009), a confusão pode ser facilmente 
resolvida deixando explícitas as hipóteses em relação às informações disponíveis 
ao vendedor e a extensão do mercado em questão. **Se o vendedor tem informação 
total sobre todas as ofertas potenciais, a propriedade será vendida ao maior 
preço**.

--

  - **A realidade, contudo, é que o vendedor não terá a informação completa
  sobre o tamanho e a distribuição das ofertas**. Do ponto de vista do vendedor, 
  a venda terá lugar ao máximo preço possível. Do ponto de vista de um 
  observador onisciente, contudo, a propriedade será negociada, *a priori*, ao 
  preço mais provável. Este preço deverá ser um preço 'médio', apenas porque 
  haverá mais compradores naquele ponto e, então, uma mais alta probabilidade de 
  consumar a negociação.

--

  - Deve-se lembrar que o **valor de mercado é uma estimativa de um preço de
  venda que não se realizou e provavelmenten nunca se realizará**. O preço 
  realizado é, portanto, inteiramente uma questão de probabilidade

--

* As reflexões acima se referem à localização do valor de mercado dentro de uma
distribuição de probabilidade de dados de venda. E em relação aos dados de 
oferta? O valor de mercado pode ser encontrado dentro da distribuição de 
probabilidades de dados de oferta? Em que região?

---
# Conceitos e Paradigmas

## Onde se situa o **VM** na distribuição de dados de oferta?

--

* **Hipótese:** Em um mercado desaquecido, as negociações se concretizam com 
grandes descontos em relação aos preços anunciados! O valor de mercado se 
encontra distante da região central da distribuição de probabilidades de dados 
de oferta!

&lt;img src="images/unnamed-chunk-1-1.svg" style="display: block; margin: auto;" /&gt;

---
# Conceitos e Paradigmas

## Onde se situa o **VM** na distribuição de dados de oferta?

--

* **Hipótese:** Em um mercado aquecido, o valor de mercado se situa próximo ao 
centro da distribuição dos dados de oferta. As negociações se dão com pouco 
desconto, ou ainda, em valores acima dos preços anunciados!

&lt;img src="images/unnamed-chunk-2-1.svg" style="display: block; margin: auto;" /&gt;

---
# Conceitos e Paradigmas

## Crítica das definições de **VM** elaboradas a partir da teoria dos custos de transação
  
--

* a maior parte da literatura sobre o mercado imobiliário é escrita sobre o 
paradigma do mercados perfeitos neoclássicos - muitos compradores, muitos 
vendedores, produtos homogêneos, informações completas, etc (Evans, 1995, p. 6; 
ver tb comentários de Watkins, 1998, p. 57).

--
  
  - atores nos mercados reais, no entanto, se deparam com custos de transação 
  positivos, especialmente advindos de informação incompleta.

--

  - uma vez que os custos de transação são introduzidos, a aquisição de 
  conhecimento ilimitado torna-se muito cara, ou ainda, impossível.
  
--

* Em um extremo, tem-se a condição de mercado perfeito, e num outro extremo, 
tem-se a condição de mercado inexistente. Entre as duas situações, partindo do
extremo de mercado inexistente, à medida que os custos de transação diminuem,
ruma-se para a condição de mercado perfeito, onde existem muitos compradores,
muitos vendedores e informação perfeita, *i.e.* os custos de transação são
iguais a zero.

---
background-image: url(https://news.berkeley.edu/wp-content/uploads/2014/07/cats300.jpg)
background-size: contain

# O gato de Schrodinger

---
class: inverse, center, middle

# Estado da arte

---
# Estado da arte

* It would seem therefore that valuation theory is faced with the simultaneity 
problem akin to that of quantum  
physics where, in this case, **market value cannot exist simultaneously with the 
need for valuation**. Valuers are required when transaction costs are high but 
at this point market value does not exist. Conversely, valuers are not required 
when transaction costs are zero and market value has emerged 
[Mooya (2009, p. 694-695)](#bib-mooya2009).

--

* **Eles (os avaliadores) são produtores e vendedores de informação sobre os 
mercados imobiliários**, realizando a importante função de unir compradores e 
vendedores, para os quais, usualmente, a informação é faltante. É argumentado
aqui que os **avaliadores não são meros coletores passivos de informação de
mercado**. Pelo contrário, **eles ativamente criam informação onde nenhuma 
existe, para possibilitar que os mercados imobiliários funcionem**.

--

* Ao estimar o 'valor de mercado' de uma propriedade, um avaliador está 
efetivamente estabelecendo uma regra para o mercado em questão

--

  - Deve ser enfatizado que os avaliadores não se propõem conscientemente a 
  impor essas normas ao mercado, mas, mesmo assim, este é o efeito de suas ações. 
  Uma vez que o 'valor de mercado' foi fornecido, os participantes do mercado não 
  precisam pesquisar pessoalmente a distribuição de preços.

--

  - Além disso, o 'valor de mercado' fornece uma âncora sobre a qual a 
  negociação entre os participantes podem ser baseados. **'Valor de mercado' é, 
  portanto, um dispositivo para diminuir os custos de transação. Sua função é 
  estabilizar as expectativas do mercado por meio do fornecimento de informações 
  sobre preços**.

---
# Estado da arte

* &lt;a name=cite-erba2019&gt;&lt;/a&gt;[Erba (2019, p.40)](#bib-erba2019): En el área catastral es 
justamente la georreferenciación que permite estructurar bases de datos  
con la ubicación, forma y dimensiones de cada parcela, dándole continuidad a la 
información territorial.
  
--
  
* En el área de catastro económico no pasa lo mismo, los datos no son 
comparables por falta de estandarización y de una referencia única [...] Para 
salir de estas trampas es necesario que se establezca una política catastral 
clara y objetiva, que referencie a todos los valores de los inmuebles a un 
sistema único el cual, inobjetablemente, debería ser el mercado inmobiliario.

--

* Não é isto, então, justamente o que falta na AL? Não apenas ao CTM, como 
argumenta Erba, um referenciamento ao mercado imobiliário, como, inversamente,
também falta ao mercado imobiliário um sistema de ancoragem, que é a informação 
cadastral!?

--

  - Se as informações cadastrais últimas estivessem disponíveis aos avaliadores, 
  não haveria problema para estimar o fator oferta.
  
--

  - Se as informações cadastrais últimas estivessem disponíveis aos avaliadores,
  estes não necessitariam utilizar "fatores consagrados", através dos quais
  estão a inserir uma informação no mercado, de origem duvidosa.
  
--

  - Se as informações cadatrais últimas estivessem disponíveis aos proprietários,
  potenciais compradores e corretores, as ofertas ficariam, provavelmente, 
  ancoradas nos preços das últimas transações, dando estabilidade ao mercado.
  
---
# Estado da arte

* Criação de valor de mercado *ex nihilo*:

--

  - Windhoek, Namíbia ([Mooya, 2009](#bib-mooya2009)): Na falta de melhores 
  informações, o mercado estava ancorado nos valores constantes do cadastro 
  municipal, que estava com valores desatualizados;
    
--

  - Um avaliador foi consultado a respeito do valor de mercado de uma 
propriedade em terras de propriedade comunal, que não eram possíveis de ser
negociadas até aquele momento. Não havia informação mercadológica disponível, 
portanto, para a avaliação dessa terra.

--

  - De uma maneira ou de outra o avaliador, para a satisfação do seu cliente,
entregou um laudo de avaliação da área.

--
  
  - Após a avaliação, um mercado sobre aquelas terras se desenvolveu, ancorado
no valor da avaliação prévia.
    
--

* Em suma:

--

  - O valor de mercado é normativo!
  
--

  - O valor de mercado pode ser estabelecido para qualquer mercado, tenha ele
  liquidez ou não.

--

  - avaliadores podem e realmente influenciam, ou até determinam os preços em
  mercados imobiliários.

---
# Estado da Arte: Estimação do fator oferta

* Utilizado para homogeneizar os dados de oferta com os dados de transações,
visando estimar o valor de  
mercado.

--

* Assumido multiplicativo: `\(P_{R} = \lambda P_{L}\)` &lt;a name=cite-chinloy&gt;&lt;/a&gt;([Chinloy, 1980](#bib-chinloy)).

--

* &lt;a name=cite-horowitz&gt;&lt;/a&gt;[Horowitz (1992)](#bib-horowitz) remove a hipótese multiplicativa e ajusta um modelo 
econométrico para estimar os valores de venda à partir dos valores listados e
das características dos imóveis, com a hipótese que `\(P_R &lt; P_L\)`

--

* &lt;a name=cite-haurin&gt;&lt;/a&gt;[Haurin, McGreal, Adair, Brown, and Webb (2013)](#bib-haurin) mostram que, em períodos de *boom*, no MI os preços 
de venda podem superar os preços de oferta.

--

* Novas estratégias de venda podem afetar o valor do fator oferta. Enquanto nas
estratégias convencionais o valor reservado é menor do que o valor ofertado, nas
novas estratégias de venda é facultado ao proprietário ofertar o seu imóvel a 
um valor mais baixo que o de mercado, criando assim condições para um maior 
número de ofertas (leilão).

---
background-image: url(./images/1-s2.0-S1051137713000041-gr1.jpg)
background-size: contain

# Fator oferta vs. Tempo

---
# Estado da Arte: O fator oferta
    
## Conclusão

* A relação entre oferta/transação depende do mercado em questão e do momento em 
análise;

--

* O avaliador deve analisar os dados de oferta e transação para tomar a melhor
decisão sobre a relação momentânea entre ofertas e transações e a melhor maneira
de modelá-la;

--

* O avaliador deve prospectar o mercado para averiguar a eventual existência de
diferentes estratégias de venda nos preços ofertados;

--

* Na falta de melhores informações do mercado, o avaliador deve estar ciente de
que estará inserindo informação no mercado. O melhor a fazer é estabelecer uma 
hipótese clara sobre a relação oferta/transação e deixar isso claro em seu laudo.
    
---
class: inverse, center, middle

# Aplicações

---
# Estimação do Fator Oferta

* &lt;a name=cite-NBR1465302&gt;&lt;/a&gt;[ABNT (2011)](#bib-NBR1465302): 

--

  - 9.2.1.3 **É permitida a utilização de tratamento prévio dos preços**
  observados, **limitado a um único fator de homogeneização**, desde que
  fundamentado conforme 8.2.1.4.2, sem prejuízo dos ajustes citados em 9.2.1.2
  (**exemplo: aplicação do fator de fonte para a transformação de preços de 
  oferta para as condições de transação**). 
  
--

  - **Os fatores devem ser calculados por metodologia científica**, como citado 
  em 8.2.1.4.3, justificados do ponto de vista teórico e prático, com a inclusão
  de validação, quando pertinente [...]
  
--

  - Para a utilização deste tratamento **é recomendável que seja evitado** o uso 
  de **fatores que**, aplicados isoladamente em relação ao avaliando ou ao 
  paradigma, **heterogeneizem os valores originais**. Essa recomendação só é 
  válida com a confirmação do efeito de heterogeneização, após a aplicação 
  conjunta dos fatores. 
  
--

* &lt;a name=cite-ibapeSP&gt;&lt;/a&gt;[IBAPE/SP (2011)](#bib-ibapeSP):

--

  - 10.1 A superestimativa dos dados de oferta (elasticidade dos negócios)
  deverá ser descontada do valor total pela aplicação do fator médio observado
  no mercado. **Na impossibilidade da sua determinação, pode ser aplicado o fator
  consagrado 0,9** (desconto de 10% sobre o preço original pedido)...
  
--

  - Forma mista: 10.6 - 1. A utilização dos fatores deve ser na forma de 
  somatório, **após a consideração do fator oferta**.
  
---
# Estimação do Fator Oferta

* &lt;a name=cite-lima2006&gt;&lt;/a&gt;[Lima (2006)](#bib-lima2006) mostrou como estimar os fatores cientificamente, 
*i.e.* a partir de modelos de regressão linear, tanto  
para a forma aditiva como para a forma multiplicativa de utilização dos fatores.

--

* Basicamente, Lima mostrou que:

--

  - se os fatores são aplicados na forma aditiva, estes devem ser estimados por 
  um modelo aditivo de regressão linear, da forma:

`$$VU \sim \beta_1 X_1 + \beta_2X_2 + \ldots + \beta_kX_k + \varepsilon$$`

--

  - se os fatores são aplicados na forma multiplicativa, estes devem ser 
  estimados por um modelo de regressão na escala logarítmica, da forma:
  
$$ log(VU) \sim \beta_1X_1 + \beta_2X_2 +  \ldots + \beta_kX_k + \varepsilon$$
--

* Porém, Lima não conseguiu chegar a uma forma para a estimação do fator oferta
quando da utilização da forma mista, definida pelo IBAPE/SP, sugerindo *testar
diversos fatores fonte `\(F_f\)`, até encontrar aquele que mais ajustasse o modelo
de regressão para os demais fatores*.

---
# Estimação do Fator Oferta

* Argumento que pode-se estimar o Fator oferta ou Fator fonte para a forma mista
através do seguinte modelo de regressão:

`$$VU \sim Fonte*(\beta_1X_1 + \beta_2X_2 +  \ldots + \beta_kX_k + \varepsilon)$$`

--

* Ou seja, na forma mista, o Fator oferta pode ser estimado através de um modelo
de regressão incluindo a variável dicotômica `\(Fonte\)` (0 se oferta, 1 se venda),
interagindo com as outras variáveis explicativas na forma aditiva.

---
# Estimação do Fator Oferta

## Modelo de regressão na forma direta 


`$$VU = (1 - 0,15.Fonte)(3000 - 0,25.Area + \varepsilon)$$`


```r
R&gt; set.seed(2)
R&gt; area &lt;- runif(100, min = 250, max = 10000)
R&gt; venda &lt;- rbinom(100, 1, .5)
R&gt; vu &lt;- (1-.15*venda)*(3000 - .25*area + rnorm(100, 0, 150))
R&gt; dados &lt;- data.frame(VU = vu, Area = area, 
                  Fonte = factor(venda, 
                                 labels = c("Oferta", "Venda")))
```

--

## Como estimar o fator oferta?

---
# Estimação do Fator Oferta

### Test t para diferença entre duas médias

--

.pull-left[

* Antes da homogeneização:


```r
R&gt; t.test(VU ~ Fonte, dados,
        alternative = "greater")
```

```
## 
## 	Welch Two Sample t-test
## 
## data:  VU by Fonte
## t = 1.7467, df = 97.856, p-value = 0.04191
## alternative hypothesis: true difference in means between group Oferta and group Venda is greater than 0
## 95 percent confidence interval:
##  11.90665      Inf
## sample estimates:
## mean in group Oferta  mean in group Venda 
*##             1733.516             1492.118
```

]

.pull-right[


* Após a homogeneização:


```r
R&gt; dados &lt;- within(dados, 
                 VUhom &lt;- ifelse(Fonte == "Oferta", 
                                 .85*VU, VU))
R&gt; t.test(VUhom ~ Fonte, dados,
        alternative = "greater")
```

```
## 
## 	Welch Two Sample t-test
## 
## data:  VUhom by Fonte
## t = -0.14668, df = 96.512, p-value = 0.5582
## alternative hypothesis: true difference in means between group Oferta and group Venda is greater than 0
## 95 percent confidence interval:
##  -229.5684       Inf
## sample estimates:
## mean in group Oferta  mean in group Venda 
*##             1473.489             1492.118
```

]

--

* **Somente funciona devido à amostra ser balanceada (entre dados de ofertas e de 
transações)**.

---
# Estimação do Fator Oferta

## Forma numérica: minimização do CV

`$$F_{oferta} = 1-\arg\min_{c \in \mathbb{R}_+} \left ( \frac{\sigma[(1- c\cdot F) VU]}{\mu[(1- c\cdot F) VU)]}\right ), \text{com } \, F = \left\{\begin{matrix}
1,\,\text{se dado de oferta}\\ 
0,\, \text{se dado de venda}
\end{matrix}\right.$$`

--

&lt;img src="images/unnamed-chunk-6-1.svg" style="display: block; margin: auto;" /&gt;


---
# Estimação do Fator Oferta

## Forma numérica:  minimização do CV


```r
R&gt; cv &lt;- function(fator, vu, fonte){
   vuhom &lt;- ifelse(fonte == "Venda", vu, fator*vu)
   sd(vuhom)/mean(vuhom)
 }
R&gt; optimise(cv, c(0.5, 2), tol = 0.0001, 
          vu = dados$VU, fonte = dados$Fonte)
```

--


```
## $minimum
## [1] 0.8471863
## 
## $objective
## [1] 0.4263088
```

---
# Estimação do Fator Oferta

## Modelo de regressão na forma direta 

* **Criação de dados desbalanceados entre oferta e venda**.


`$$VU = (1 - 0,15.Fonte)(3000 - 0,25.Area + \varepsilon)$$`

--


```r
R&gt; set.seed(1)
R&gt; areavenda &lt;- runif(50, min = 1000, max = 10000)
R&gt; areaoferta &lt;-  runif(50, min = 250, max = 8000)
R&gt; venda &lt;- c(rep(0, 50), rep(1, 50))
R&gt; vuvenda &lt;- .85*(3000 - .25*areavenda + rnorm(50, 0, 150))
R&gt; vuoferta &lt;- 3000 - .25*areaoferta + rnorm(50, 0, 150)
R&gt; vu &lt;- c(vuoferta, vuvenda)
R&gt; dados &lt;- data.frame(VU = vu, Area = c(areaoferta, areavenda), 
                  Fonte = factor(venda, 
                                 labels = c("Oferta", "Venda")))
```

--

* **Os dados de oferta possuem áreas maiores**.

---
# Estimação do Fator Oferta

### Test t para diferença entre duas médias

--

.pull-left[

* Antes da homogeneização:


```r
R&gt; t.test(VU ~ Fonte, dados,
        alternative = "greater")
```

```
## 
## 	Welch Two Sample t-test
## 
## data:  VU by Fonte
## t = 5.7788, df = 97.49, p-value = 4.51e-08
## alternative hypothesis: true difference in means between group Oferta and group Venda is greater than 0
## 95 percent confidence interval:
##  431.8508      Inf
## sample estimates:
## mean in group Oferta  mean in group Venda 
*##             1939.868             1333.875
```

]

.pull-right[


* Após a homogeneização:


```r
R&gt; dados &lt;- within(dados, 
                 VUhom &lt;- ifelse(Fonte == "Oferta", 
                                 .85*VU, VU))
R&gt; t.test(VUhom ~ Fonte, dados,
        alternative = "greater")
```

```
## 
## 	Welch Two Sample t-test
## 
## data:  VUhom by Fonte
## t = 3.256, df = 97.216, p-value = 0.0007781
## alternative hypothesis: true difference in means between group Oferta and group Venda is greater than 0
## 95 percent confidence interval:
##  154.3427      Inf
## sample estimates:
## mean in group Oferta  mean in group Venda 
*##             1648.888             1333.875
```

]

---
# Estimação do Fator Oferta

## Forma numérica

`$$F_{oferta} = 1-\arg\min_{c \in \mathbb{R}_+} \left ( \frac{\sigma[(1- c\cdot F) VU]}{\mu[(1- c\cdot F) VU)]}\right ), \text{com } \, F = \left\{\begin{matrix}
1,\,\text{se dado de oferta}\\ 
0,\, \text{se dado de venda}
\end{matrix}\right.$$`

&lt;img src="images/unnamed-chunk-10-1.svg" style="display: block; margin: auto;" /&gt;

---
# Estimação do Fator Oferta

## Análise Exploratória

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/dados1-1.svg" alt="Dados randômicos de oferta (em vermelho) e transação (em verde)"  /&gt;
&lt;p class="caption"&gt;Dados randômicos de oferta (em vermelho) e transação (em verde)&lt;/p&gt;
&lt;/div&gt;

---
# Estimação do Fator Oferta

## Forma gráfica

[App Fator Oferta](http://104.248.57.29/shiny/fatorOferta/)

---
# Estimação do Fator Oferta

## Regressão Linear

.pull-left[

### Modelo mal especificado


```r
R&gt; fit &lt;- lm(VU ~ Area + Fonte, data = dados)
R&gt; S(fit, brief = T)
```

```
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 2866.65178   33.23551  86.253  &lt; 2e-16 ***
## Area          -0.22337    0.00637 -35.068  &lt; 2e-16 ***
## FonteVenda  -238.70040   30.36403  -7.861 5.28e-12 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard deviation: 142.5 on 97 degrees of freedom
## Multiple R-squared: 0.9455
## F-statistic: 840.9 on 2 and 97 DF,  p-value: &lt; 2.2e-16 
##     AIC     BIC 
## 1280.61 1291.03
```

]

.pull-right[

&lt;img src="images/unnamed-chunk-12-1.svg" style="display: block; margin: auto;" /&gt;

```
## 
## 	Shapiro-Wilk normality test
## 
## data:  residuals(fit)
## W = 0.97783, p-value = 0.08995
```

]


---
# Estimação do Fator Oferta

## Modelo mal especificado

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/dados1a-1.svg" alt="Dados randômicos de oferta (em vermelho) e transação (em verde)"  /&gt;
&lt;p class="caption"&gt;Dados randômicos de oferta (em vermelho) e transação (em verde)&lt;/p&gt;
&lt;/div&gt;

---
# Estimação do Fator Oferta

## Regressão Linear

.pull-left[

### Modelo bem especificado


```r
R&gt; fit1 &lt;- lm(VU ~ Area*Fonte, data = dados)
R&gt; S(fit1, brief = T)
```

```
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)      3.004e+03  4.136e+01  72.625  &lt; 2e-16 ***
## Area            -2.564e-01  8.952e-03 -28.637  &lt; 2e-16 ***
## FonteVenda      -5.097e+02  6.267e+01  -8.133 1.49e-12 ***
## Area:FonteVenda  5.615e-02  1.168e-02   4.808 5.64e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard deviation: 128.6 on 96 degrees of freedom
## Multiple R-squared: 0.9561
## F-statistic: 696.1 on 3 and 96 DF,  p-value: &lt; 2.2e-16 
##     AIC     BIC 
## 1261.04 1274.06
```
]

.pull-right[

&lt;img src="images/unnamed-chunk-14-1.svg" style="display: block; margin: auto;" /&gt;

```
## 
## 	Shapiro-Wilk normality test
## 
## data:  residuals(fit1)
## W = 0.98033, p-value = 0.1411
```

]

---
# Estimação do Fator Oferta

## Diferenças honestas de Tukey

.pull-left[


```r
R&gt; fm &lt;- aov(VU ~ Area*Fonte, 
            data = dados)
R&gt; TukeyHSD(fm)
```

```
##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = VU ~ Area * Fonte, data = dados)
## 
## $Fonte
##                   diff       lwr       upr p adj
*## Venda-Oferta -210.2986 -261.3499 -159.2472     0
```

]

.pull-right[


```r
R&gt; fm1 &lt;- aov(VUhom ~ Area*Fonte, 
            data = dados)
R&gt; TukeyHSD(fm1)
```

```
##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = VUhom ~ Area * Fonte, data = dados)
## 
## $Fonte
##                  diff       lwr      upr     p adj
*## Venda-Oferta 23.09297 -23.84794 70.03388 0.3312566
```

]



---
# Estimação do Fator Oferta

## Forma numérica: minimização das diferenças honestas de Tukey





```r
R&gt; optimise(THSD, c(0.5, 2), tol = 0.0001, 
          data = dados, response = "VU", predictors = "Area",
           factor = "Fonte", level = "Venda")
```

--


```
## $minimum
## [1] 0.864826
## 
## $objective
## [1] 0.02449983
```

---
# Estimação do Fator Oferta

## Aplicação prévia do fator oferta

.pull-left[


```r
R&gt; dados &lt;- within(dados, 
                 VUhom &lt;- ifelse(Fonte == "Venda", 
                                 VU, 0.865*VU))
```


```r
R&gt; fm &lt;- aov(VUhom ~ Area*Fonte, dados)
R&gt; summary(fm)
```

```
##             Df   Sum Sq  Mean Sq  F value Pr(&gt;F)    
## Area         1 24844048 24844048 1747.413 &lt;2e-16 ***
## Fonte        1        2        2    0.000 0.9912    
## Area:Fonte   1    56237    56237    3.955 0.0496 *  
## Residuals   96  1364891    14218                    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```



```r
R&gt; # CV dados crus
R&gt; sd(dados$VU)/mean(dados$VU)
```

```
## [1] 0.369026
```

]

.pull-right[

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/dadosHomogeneizados-1.svg" alt="Dados homogeneizados."  /&gt;
&lt;p class="caption"&gt;Dados homogeneizados.&lt;/p&gt;
&lt;/div&gt;



```r
R&gt; # CV dados homogeneizados
R&gt; sd(dados$VUhom)/mean(dados$VUhom)
```

```
## [1] 0.3420327
```

]

---
# Estimação do Fator Oferta

## Aplicação prévia do fator oferta



```r
R&gt; fithom &lt;- lm(VUhom ~ Area, dados)
R&gt; S(fithom, brief = T)
```

```
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  2.546e+03  2.785e+01   91.39   &lt;2e-16 ***
## Area        -2.091e-01  5.052e-03  -41.39   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard deviation: 120.4 on 98 degrees of freedom
## Multiple R-squared: 0.9459
## F-statistic:  1713 on 1 and 98 DF,  p-value: &lt; 2.2e-16 
##     AIC     BIC 
## 1245.97 1253.78
```

---
# Estimação do Fator Oferta

## Resumo



&lt;table style="border-collapse:collapse; border:none;"&gt;
&lt;tr&gt;
&lt;th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; "&gt;&amp;nbsp;&lt;/th&gt;
&lt;th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;VU&lt;/th&gt;
&lt;th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;VU&lt;/th&gt;
&lt;th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;VUhom&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; "&gt;Predictors&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;CI&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;p&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;CI&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  col7"&gt;p&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  col8"&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  col9"&gt;CI&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  0"&gt;p&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;(Intercept)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;2866.65&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;2800.69&amp;nbsp;&amp;ndash;&amp;nbsp;2932.62&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;3003.57&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;2921.47&amp;nbsp;&amp;ndash;&amp;nbsp;3085.66&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;2545.53&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col9"&gt;2490.26&amp;nbsp;&amp;ndash;&amp;nbsp;2600.81&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  0"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;Area&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.22&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.24&amp;nbsp;&amp;ndash;&amp;nbsp;-0.21&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.26&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.27&amp;nbsp;&amp;ndash;&amp;nbsp;-0.24&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;&amp;#45;0.21&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col9"&gt;&amp;#45;0.22&amp;nbsp;&amp;ndash;&amp;nbsp;-0.20&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  0"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;Fonte [Venda]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;238.70&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;298.96&amp;nbsp;&amp;ndash;&amp;nbsp;-178.44&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;509.71&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;634.11&amp;nbsp;&amp;ndash;&amp;nbsp;-385.30&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col9"&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  0"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;Area * Fonte [Venda]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;0.06&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;0.03&amp;nbsp;&amp;ndash;&amp;nbsp;0.08&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col9"&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  0"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;"&gt;Observations&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3"&gt;100&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3"&gt;100&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3"&gt;100&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;"&gt;R&lt;sup&gt;2&lt;/sup&gt; / R&lt;sup&gt;2&lt;/sup&gt; adjusted&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;0.945 / 0.944&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;0.956 / 0.955&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;0.946 / 0.945&lt;/td&gt;
&lt;/tr&gt;

&lt;/table&gt;


---
# Estimação do Fator Oferta

## Previsão de valores

.pull-left[


```r
R&gt; new250 &lt;- 
   data.frame(Area = 250, Fonte = "Venda")
R&gt; predict(fit, newdata = new250,
         interval = "confidence", level = .80)
```

```
##        fit      lwr      upr
*## 1 2572.108 2519.648 2624.568
```


```r
R&gt; predict(fit1, newdata = new250,
         interval = "confidence", level = .80)
```

```
##        fit      lwr      upr
*## 1 2443.802 2385.259 2502.345
```


```r
R&gt; predict(fithom, newdata = new250,
         interval = "confidence", level = .80)
```

```
##       fit      lwr      upr
*## 1 2493.25 2458.773 2527.726
```
]

.pull-right[


```r
R&gt; new10000 &lt;- 
   data.frame(Area = 10000, Fonte = "Venda")
R&gt; predict(fit, newdata = new10000,
         interval = "confidence", level = .80)
```

```
##        fit      lwr      upr
*## 1 394.2191 350.9564 437.4818
```


```r
R&gt; predict(fit1, newdata = new10000,
         interval = "confidence", level = .80)
```

```
##        fit      lwr      upr
*## 1 491.5866 444.6049 538.5684
```


```r
R&gt; predict(fithom, newdata = new10000,
         interval = "confidence", level = .80)
```

```
##        fit     lwr      upr
*## 1 454.2788 418.001 490.5567
```

]

---
# Estimação do Fator Oferta

## Dados lognormais

--

Uma das propriedades da função logarítmica é: `\(\log(x \cdot y) = \log(x) + \log(y)\)`

--

Portanto, se `\(V_{venda} = 0,85\cdot V_{oferta}\)`, na escala `\(\log\)`:

--

`$$\log(V_{venda}) = \log(0,85\cdot V_{oferta}) = \log (0,85) + \log(V_{oferta})$$`

`$$\log(V_{oferta}) = \log(V_{venda}) - \log(0,85)$$` 

--

`$$\log(V_{oferta}) = \log(V_{venda}) - 0,1625$$`

--

`$$\log(VU) = 7,5 - 0,25\cdot \log(Area) - 0,1625\cdot Fonte + \varepsilon$$`

--


```r
R&gt; set.seed(2)
R&gt; area &lt;- runif(100, min = 250, max = 5000)
R&gt; venda &lt;- rbinom(100, 1, .5)
R&gt; lvu &lt;- 7.5 - .25*log(area) -.1625*venda + rnorm(100, mean = 0, sd = .05)
R&gt; dados &lt;- data.frame(VU = exp(lvu), Area = area, 
                  Fonte = factor(venda, labels = c("Oferta", "Venda")))
```

---
# Estimação do Fator Oferta

## Dados lognormais: análise exploratória

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/lognormalExploratoria-1.svg" alt="Análise exploratória. Dados lognormais."  /&gt;
&lt;p class="caption"&gt;Análise exploratória. Dados lognormais.&lt;/p&gt;
&lt;/div&gt;


---
# Estimação do Fator Oferta

.pull-left[

## Modelo bem especificado


```r
R&gt; fit2 &lt;- lm(log(VU) ~ log(Area) + Fonte, 
            data = dados)
R&gt; S(fit2, brief = T)
```

```
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  7.507161   0.054010  139.00   &lt;2e-16 ***
## log(Area)   -0.251045   0.007012  -35.80   &lt;2e-16 ***
*## FonteVenda  -0.157503   0.009974  -15.79   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard deviation: 0.0497 on 97 degrees of freedom
## Multiple R-squared: 0.9412
## F-statistic: 776.1 on 2 and 97 DF,  p-value: &lt; 2.2e-16 
##     AIC     BIC 
## -311.59 -301.17
```
]

.pull-right[

## Cálculo do Fator Oferta a partir do coeficiente estimado


```r
R&gt; # Cálculo do Fator Oferta
R&gt; exp(-.157503)
```

```
## [1] 0.8542743
```
]

---
# Estimação do Fator Oferta

## Modelo bem especificado

&lt;img src="images/unnamed-chunk-34-1.svg" style="display: block; margin: auto;" /&gt;

---
# Estimação do Fator Oferta

## Modelo bem especificado

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/fit2Diagnostics-1.svg" alt="Modelo correto. Fator oferta. Dados lognormais." width="38%" /&gt;&lt;img src="images/fit2Diagnostics-2.svg" alt="Modelo correto. Fator oferta. Dados lognormais." width="38%" /&gt;&lt;img src="images/fit2Diagnostics-3.svg" alt="Modelo correto. Fator oferta. Dados lognormais." width="38%" /&gt;&lt;img src="images/fit2Diagnostics-4.svg" alt="Modelo correto. Fator oferta. Dados lognormais." width="38%" /&gt;
&lt;p class="caption"&gt;Modelo correto. Fator oferta. Dados lognormais.&lt;/p&gt;
&lt;/div&gt;


---
# Estimação do Fator Oferta

## Aplicação prévia do Fator Oferta



```r
R&gt; optimise(THSD, c(0.5, 2), tol = 0.0001, 
          data = dados, response = "VU", predictors = "log(Area)",
           factor = "Fonte", level = "Venda", transf = "log")
```

--


```
## $minimum
## [1] 0.8542646
## 
## $objective
## [1] 1.119604e-05
```


---
# Estimação do Fator Oferta

## Aplicação prévia do Fator Oferta

.pull-left[

```r
R&gt; dados &lt;- within(dados, 
                 VUhom &lt;- ifelse(Fonte == "Venda", 
                                 VU,  0.85*VU))
R&gt; fithom2 &lt;- lm(log(VUhom) ~ log(Area), dados)
R&gt; S(fithom2, brief = T)
```

```
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  7.346462   0.053683  136.85   &lt;2e-16 ***
## log(Area)   -0.250981   0.006984  -35.94   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard deviation: 0.04951 on 98 degrees of freedom
## Multiple R-squared: 0.9295
## F-statistic:  1292 on 1 and 98 DF,  p-value: &lt; 2.2e-16 
##     AIC     BIC 
## -313.33 -305.52
```
]

.pull-right[


```r
R&gt; sd(dados$VU)/mean(dados$VU)
```

```
## [1] 0.2204912
```


```r
R&gt; sd(dados$VUhom)/mean(dados$VUhom)
```

```
## [1] 0.2007681
```
]


---
# Estimação do Fator Oferta

## Aplicação prévia do fator oferta


&lt;img src="images/unnamed-chunk-38-1.svg" style="display: block; margin: auto;" /&gt;


---
# Estimação do Fator Oferta

## Aplicação prévia do Fator Oferta

&lt;img src="images/unnamed-chunk-39-1.svg" style="display: block; margin: auto;" /&gt;

---
# Estimação do Fator Oferta

## Diagnóstico modelo com dados homogeneizados

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/fit2homDiagnostics-1.svg" alt="Modelo com dados homogeneizados. Dados lognormais." width="38%" /&gt;&lt;img src="images/fit2homDiagnostics-2.svg" alt="Modelo com dados homogeneizados. Dados lognormais." width="38%" /&gt;&lt;img src="images/fit2homDiagnostics-3.svg" alt="Modelo com dados homogeneizados. Dados lognormais." width="38%" /&gt;&lt;img src="images/fit2homDiagnostics-4.svg" alt="Modelo com dados homogeneizados. Dados lognormais." width="38%" /&gt;
&lt;p class="caption"&gt;Modelo com dados homogeneizados. Dados lognormais.&lt;/p&gt;
&lt;/div&gt;

---
# Estimação do Fator Oferta

## Resumo dos modelos

&lt;table style="border-collapse:collapse; border:none;"&gt;
&lt;tr&gt;
&lt;th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; "&gt;&amp;nbsp;&lt;/th&gt;
&lt;th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;log(VU)&lt;/th&gt;
&lt;th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;log(VUhom)&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; "&gt;Predictors&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;CI&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;p&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;CI&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  col7"&gt;p&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;(Intercept)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;7.51&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;7.40&amp;nbsp;&amp;ndash;&amp;nbsp;7.61&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;7.35&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;7.24&amp;nbsp;&amp;ndash;&amp;nbsp;7.45&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;Area [log]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.25&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.26&amp;nbsp;&amp;ndash;&amp;nbsp;-0.24&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.25&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.26&amp;nbsp;&amp;ndash;&amp;nbsp;-0.24&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;Fonte [Venda]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.16&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.18&amp;nbsp;&amp;ndash;&amp;nbsp;-0.14&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;"&gt;Observations&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3"&gt;100&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3"&gt;100&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;"&gt;R&lt;sup&gt;2&lt;/sup&gt; / R&lt;sup&gt;2&lt;/sup&gt; adjusted&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;0.941 / 0.940&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;0.929 / 0.929&lt;/td&gt;
&lt;/tr&gt;

&lt;/table&gt;

---
# Estimação do Fator Oferta

## Previsão de valores

.pull-left[


```r
R&gt; new250 &lt;- 
   data.frame(Area = 250, Fonte = "Venda")
R&gt; exp(predict(fit2, newdata = new250,
         interval = "confidence", level = .80))
```

```
##        fit      lwr      upr
*## 1 388.9779 380.6658 397.4714
```



```r
R&gt; exp(predict(fithom2, newdata = new250,
         interval = "confidence", level = .80))
```

```
##        fit      lwr      upr
*## 1 387.8732 380.0972 395.8082
```
]

.pull-right[


```r
R&gt; new5000 &lt;- 
   data.frame(Area = 5000, Fonte = "Venda")
R&gt; exp(predict(fit2, newdata = new5000,
         interval = "confidence", level = .80))
```

```
##        fit      lwr     upr
*## 1 183.3614 181.1409 185.609
```


```r
R&gt; exp(predict(fithom2, newdata = new5000,
         interval = "confidence", level = .80))
```

```
##        fit      lwr      upr
*## 1 182.8754 181.0442 184.7252
```

]

---
# Estimação do Fator Oferta

## Outras transformações

`$$VU = (1-0,15\cdot Fonte)(70 - 0,01\cdot Area + \varepsilon)^2$$`


```r
R&gt; set.seed(2)
R&gt; area &lt;- runif(100, min = 250, max = 5000)
R&gt; venda &lt;- rbinom(100, 1, .5)
R&gt; sqrtvu &lt;- 70 - .01*area + rnorm(100, mean = 0, sd = 2)
R&gt; vu &lt;- (1-.15*venda)*sqrtvu^2
R&gt; dados &lt;- data.frame(VU = vu, Area = area, 
                  Fonte = factor(venda, labels = c("Oferta", "Venda")))
```

---
# Estimação do Fator Oferta

## Outras transformações: análise exploratória

&lt;img src="images/unnamed-chunk-46-1.svg" style="display: block; margin: auto;" /&gt;

---
# Modelo mal especificado


```r
R&gt; fit3 &lt;- lm(sqrt(VU) ~ Area + Fonte, data = dados)
R&gt; S(fit3, brief = T)
```

```
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 69.086281   0.461259 149.777  &lt; 2e-16 ***
## Area        -0.009660   0.000143 -67.544  &lt; 2e-16 ***
## FonteVenda  -3.260870   0.404871  -8.054 2.06e-12 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard deviation: 2.018 on 97 degrees of freedom
## Multiple R-squared: 0.9794
## F-statistic:  2311 on 2 and 97 DF,  p-value: &lt; 2.2e-16 
##    AIC    BIC 
## 429.15 439.57
```

---
# Modelo mal especificado

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/fit3Diagnostics-1.svg" alt="Modelo mal especificado. Fator oferta." width="38%" /&gt;&lt;img src="images/fit3Diagnostics-2.svg" alt="Modelo mal especificado. Fator oferta." width="38%" /&gt;&lt;img src="images/fit3Diagnostics-3.svg" alt="Modelo mal especificado. Fator oferta." width="38%" /&gt;&lt;img src="images/fit3Diagnostics-4.svg" alt="Modelo mal especificado. Fator oferta." width="38%" /&gt;
&lt;p class="caption"&gt;Modelo mal especificado. Fator oferta.&lt;/p&gt;
&lt;/div&gt;

---
# Modelo correto


```r
R&gt; fit4 &lt;- lm(sqrt(VU) ~ Area*Fonte, data = dados)
R&gt; S(fit4, brief = T)
```

```
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     70.1570222  0.5412342 129.624  &lt; 2e-16 ***
## Area            -0.0100733  0.0001830 -55.054  &lt; 2e-16 ***
## FonteVenda      -5.6434584  0.8042935  -7.017 3.21e-10 ***
## Area:FonteVenda  0.0009221  0.0002733   3.373  0.00107 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard deviation: 1.918 on 96 degrees of freedom
## Multiple R-squared: 0.9816
## F-statistic:  1709 on 3 and 96 DF,  p-value: &lt; 2.2e-16 
##    AIC    BIC 
## 419.94 432.97
```

---
# Modelo correto

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/rightModel3-1.svg" alt="Fator oferta com transformação raiz quadrada. Modelo especificado corretamente." width="50%" /&gt;&lt;img src="images/rightModel3-2.svg" alt="Fator oferta com transformação raiz quadrada. Modelo especificado corretamente." width="50%" /&gt;
&lt;p class="caption"&gt;Fator oferta com transformação raiz quadrada. Modelo especificado corretamente.&lt;/p&gt;
&lt;/div&gt;

---
# Modelo correto

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/fit4Diagnostics-1.svg" alt="Modelo mal especificado. Fator oferta." width="38%" /&gt;&lt;img src="images/fit4Diagnostics-2.svg" alt="Modelo mal especificado. Fator oferta." width="38%" /&gt;&lt;img src="images/fit4Diagnostics-3.svg" alt="Modelo mal especificado. Fator oferta." width="38%" /&gt;&lt;img src="images/fit4Diagnostics-4.svg" alt="Modelo mal especificado. Fator oferta." width="38%" /&gt;
&lt;p class="caption"&gt;Modelo mal especificado. Fator oferta.&lt;/p&gt;
&lt;/div&gt;


---
# Opção: aplicação prévia do fator oferta


```r
R&gt; optimise(THSD, c(0.5, 2), tol = 0.0001, 
          data = dados, response = "VU", predictors = "Area",
           factor = "Fonte", level = "Venda", transf = "sqrt")
```

--


```
## $minimum
## [1] 0.857683
## 
## $objective
## [1] 0.0002634676
```


---
# Opção: aplicação prévia do fator oferta

.pull-left[


```r
R&gt; dados &lt;- within(dados, 
                 VUhom &lt;- ifelse(Fonte == "Venda", 
                                 VU, .85*VU))
R&gt; fithom3 &lt;- lm(sqrt(VUhom) ~ Area, dados)
R&gt; S(fithom3, brief = T)
```

```
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 64.6088206  0.3811754  169.50   &lt;2e-16 ***
## Area        -0.0092266  0.0001294  -71.29   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard deviation: 1.826 on 98 degrees of freedom
## Multiple R-squared: 0.9811
## F-statistic:  5082 on 1 and 98 DF,  p-value: &lt; 2.2e-16 
##    AIC    BIC 
## 408.20 416.02
```

]

.pull-right[

* Coeficiente de variação dos dados crus:


```r
R&gt; sd(dados$VU)/mean(dados$VU)
```

```
## [1] 0.5861128
```

* Coeficiente de variação dos dados homogeneizados:


```r
R&gt; sd(dados$VUhom)/mean(dados$VUhom)
```

```
## [1] 0.5777287
```

]

---
# Opção: aplicação prévia do fator oferta

&lt;img src="images/unnamed-chunk-52-1.svg" style="display: block; margin: auto;" /&gt;


---
# Opção: aplicação prévia do fator oferta

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/dadosHomogeneizados3-1.svg" alt="Dados homogeneizados."  /&gt;
&lt;p class="caption"&gt;Dados homogeneizados.&lt;/p&gt;
&lt;/div&gt;

---
# Resumo



&lt;table style="border-collapse:collapse; border:none;"&gt;
&lt;tr&gt;
&lt;th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; "&gt;&amp;nbsp;&lt;/th&gt;
&lt;th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;sqrt(VU)&lt;/th&gt;
&lt;th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;sqrt(VU)&lt;/th&gt;
&lt;th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;sqrt(VUhom)&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; "&gt;Predictors&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;CI&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;p&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;CI&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  col7"&gt;p&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  col8"&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  col9"&gt;CI&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  0"&gt;p&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;(Intercept)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;69.086&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;68.171&amp;nbsp;&amp;ndash;&amp;nbsp;70.002&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;70.157&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;69.083&amp;nbsp;&amp;ndash;&amp;nbsp;71.231&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;64.609&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col9"&gt;63.852&amp;nbsp;&amp;ndash;&amp;nbsp;65.365&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  0"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;Area&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.010&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.010&amp;nbsp;&amp;ndash;&amp;nbsp;-0.009&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.010&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.010&amp;nbsp;&amp;ndash;&amp;nbsp;-0.010&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;&amp;#45;0.009&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col9"&gt;&amp;#45;0.009&amp;nbsp;&amp;ndash;&amp;nbsp;-0.009&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  0"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;Fonte [Venda]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;3.261&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;4.064&amp;nbsp;&amp;ndash;&amp;nbsp;-2.457&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;5.643&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;7.240&amp;nbsp;&amp;ndash;&amp;nbsp;-4.047&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col9"&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  0"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;Area * Fonte [Venda]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;0.001&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;0.000&amp;nbsp;&amp;ndash;&amp;nbsp;0.001&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col9"&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  0"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;"&gt;Observations&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3"&gt;100&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3"&gt;100&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3"&gt;100&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;"&gt;R&lt;sup&gt;2&lt;/sup&gt; / R&lt;sup&gt;2&lt;/sup&gt; adjusted&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;0.979 / 0.979&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;0.982 / 0.981&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;0.981 / 0.981&lt;/td&gt;
&lt;/tr&gt;

&lt;/table&gt;

---
# Previsão de valores

.pull-left[


```r
R&gt; new250 &lt;- 
   data.frame(Area = 250, Fonte = "Venda")
R&gt; predict(fit3, newdata = new250,
         interval = "confidence", level = .80)^2
```

```
##        fit      lwr      upr
*## 1 4020.876 3948.145 4094.271
```


```r
R&gt; predict(fit4, newdata = new250,
         interval = "confidence", level = .80)^2
```

```
##        fit      lwr      upr
*## 1 3872.045 3784.093 3961.007
```


```r
R&gt; predict(fithom3, newdata = new250,
         interval = "confidence", level = .80)^2
```

```
##        fit      lwr     upr
*## 1 3881.562 3824.999 3938.54
```
]

.pull-right[


```r
R&gt; new5000 &lt;- 
   data.frame(Area = 5000, Fonte = "Venda")
R&gt; predict(fit3, newdata = new5000,
         interval = "confidence", level = .80)^2
```

```
##        fit      lwr     upr
*## 1 307.1146 286.8096 328.114
```


```r
R&gt; predict(fit4, newdata = new5000,
         interval = "confidence", level = .80)^2
```

```
##        fit      lwr      upr
*## 1 351.8401 324.9102 379.8422
```


```r
R&gt; predict(fithom3, newdata = new5000,
         interval = "confidence", level = .80)^2
```

```
##       fit      lwr      upr
*## 1 341.363 324.3225 358.8399
```

]

---
# Fator Oferta na regressão múltipla


```r
R&gt; library(MASS)
R&gt; ##                X1       X2      Y
R&gt; sigma &lt;- matrix(c(16  ,    15,  10.2,
                   15  ,    25,    8,
                   10.2,     8,    9),
                 ncol = 3, byrow = T)
R&gt; set.seed(2)
R&gt; dados &lt;- mvrnorm(n=200,
               mu=c(100, 50, 30),
               Sigma=sigma)
R&gt; colnames(dados) &lt;- c("X1", "X2", "y")
R&gt; dados &lt;- as.data.frame(dados)
R&gt; # cor(dados)
R&gt; # cov(dados)
R&gt; dados$Fonte &lt;- rbinom(200, 1, .5)
R&gt; dados$y &lt;- (1 - .15*dados$Fonte)*dados$y
R&gt; dados$Fonte &lt;- factor(dados$Fonte, labels = c("Oferta", "Venda"))
```




---
# Análise Exploratória

&lt;img src="images/unnamed-chunk-63-1.svg" style="display: block; margin: auto;" /&gt;


---
# Modelo mal especificado


```r
R&gt; fitMult &lt;- lm(y ~ X1 + X2 + Fonte, dados)
R&gt; S(fitMult, brief = T)
```

```
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -32.49863    2.83932 -11.446  &lt; 2e-16 ***
## X1            0.68564    0.03850  17.811  &lt; 2e-16 ***
## X2           -0.12137    0.03109  -3.904  0.00013 ***
## FonteVenda   -4.37711    0.20723 -21.122  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard deviation: 1.457 on 196 degrees of freedom
## Multiple R-squared: 0.847
## F-statistic: 361.7 on 3 and 196 DF,  p-value: &lt; 2.2e-16 
##    AIC    BIC 
## 724.13 740.62
```

---
# Modelo mal especificado

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/fitMultDiagnostics-1.svg" alt="Modelo mal especificado. Fator oferta." width="38%" /&gt;&lt;img src="images/fitMultDiagnostics-2.svg" alt="Modelo mal especificado. Fator oferta." width="38%" /&gt;&lt;img src="images/fitMultDiagnostics-3.svg" alt="Modelo mal especificado. Fator oferta." width="38%" /&gt;&lt;img src="images/fitMultDiagnostics-4.svg" alt="Modelo mal especificado. Fator oferta." width="38%" /&gt;
&lt;p class="caption"&gt;Modelo mal especificado. Fator oferta.&lt;/p&gt;
&lt;/div&gt;

---
# Resíduos Parciais




`$$p_i = r_i + \hat \beta_jX_i^{(j)}$$`

&lt;img src="images/unnamed-chunk-66-1.svg" style="display: block; margin: auto;" /&gt;

---
# Modelo Correto


```r
R&gt; fitMult2 &lt;- lm(y ~ (X1 + X2)*Fonte, data = dados)
R&gt; S(fitMult2, brief = T)
```

```
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   -44.13986    3.93393 -11.220  &lt; 2e-16 ***
## X1              0.80796    0.05250  15.390  &lt; 2e-16 ***
## X2             -0.13452    0.04274  -3.147  0.00191 ** 
## FonteVenda     17.47534    5.43985   3.212  0.00154 ** 
## X1:FonteVenda  -0.23624    0.07388  -3.197  0.00162 ** 
## X2:FonteVenda   0.03720    0.05972   0.623  0.53410    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard deviation: 1.398 on 194 degrees of freedom
## Multiple R-squared: 0.8607
## F-statistic: 239.7 on 5 and 194 DF,  p-value: &lt; 2.2e-16 
##    AIC    BIC 
## 709.42 732.51
```

---
# Modelo Correto

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/unnamed-chunk-68-1.svg" alt="Regressão Múltiplo. Modelo Correto. Fator Oferta." width="50%" /&gt;&lt;img src="images/unnamed-chunk-68-2.svg" alt="Regressão Múltiplo. Modelo Correto. Fator Oferta." width="50%" /&gt;
&lt;p class="caption"&gt;Regressão Múltiplo. Modelo Correto. Fator Oferta.&lt;/p&gt;
&lt;/div&gt;

---
# Modelo Correto

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="images/fitMul2tDiagnostics-1.svg" alt="Modelo mal especificado. Fator oferta." width="38%" /&gt;&lt;img src="images/fitMul2tDiagnostics-2.svg" alt="Modelo mal especificado. Fator oferta." width="38%" /&gt;&lt;img src="images/fitMul2tDiagnostics-3.svg" alt="Modelo mal especificado. Fator oferta." width="38%" /&gt;&lt;img src="images/fitMul2tDiagnostics-4.svg" alt="Modelo mal especificado. Fator oferta." width="38%" /&gt;
&lt;p class="caption"&gt;Modelo mal especificado. Fator oferta.&lt;/p&gt;
&lt;/div&gt;

---
# Opção: aplicação prévia do fator oferta







```r
R&gt; optimise(THSD, c(0.5, 2), tol = 0.0001, 
          data = dados, response = "y", predictors = c("X1", "X2"),
           factor = "Fonte", level = "Venda")
```

--


```
## $minimum
## [1] 0.8531464
## 
## $objective
## [1] 0.0001556124
```

---
# Opção: aplicação prévia do fator oferta

.pull-left[


```r
R&gt; dados &lt;- within(dados, 
                 yhom &lt;- ifelse(Fonte == "Venda", 
                                 y, .85*y))
R&gt; fithom4 &lt;- lm(yhom ~ X1 + X2, dados)
R&gt; S(fithom4, brief = T)
```

```
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -31.56188    2.46428 -12.808  &lt; 2e-16 ***
## X1            0.62436    0.03349  18.642  &lt; 2e-16 ***
## X2           -0.10647    0.02707  -3.933 0.000116 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard deviation: 1.274 on 197 degrees of freedom
## Multiple R-squared: 0.7626
## F-statistic: 316.4 on 2 and 197 DF,  p-value: &lt; 2.2e-16 
##    AIC    BIC 
## 669.28 682.47
```

]

.pull-right[

* Coeficiente de variação dos dados crus:


```r
R&gt; sd(dados$y)/mean(dados$y)
```

```
## [1] 0.1312783
```

* Coeficiente de variação dos dados homogeneizados:


```r
R&gt; sd(dados$yhom)/mean(dados$yhom)
```

```
## [1] 0.1008243
```

]

---
# Gráficos Modelo Homogeneizado




&lt;img src="images/unnamed-chunk-74-1.svg" style="display: block; margin: auto;" /&gt;

---
# Previsão de valores

.pull-left[


```r
R&gt; new90_40 &lt;- 
   data.frame(X1 = 90, X2 = 40, Fonte = "Venda")
R&gt; predict(fitMult, newdata = new90_40,
         interval = "confidence", level = .80)
```

```
##        fit      lwr      upr
*## 1 19.97759 19.61092 20.34425
```


```r
R&gt; predict(fitMult2, newdata = new90_40,
         interval = "confidence", level = .80)
```

```
##        fit      lwr      upr
*## 1 20.89722 20.45255 21.34189
```


```r
R&gt; predict(fithom4, newdata = new90_40,
         interval = "confidence", level = .80)
```

```
##        fit      lwr      upr
*## 1 20.37176 20.06987 20.67365
```
]

.pull-right[


```r
R&gt; new110_60 &lt;- 
   data.frame(X1 = 110, X2 = 60, Fonte = "Venda")
R&gt; predict(fitMult, newdata = new110_60,
         interval = "confidence", level = .80)
```

```
##        fit      lwr      upr
*## 1 31.26314 30.90122 31.62506
```


```r
R&gt; predict(fitMult2, newdata = new110_60,
         interval = "confidence", level = .80)
```

```
##        fit      lwr      upr
*## 1 30.38508 29.94864 30.82153
```


```r
R&gt; predict(fithom4, newdata = new110_60,
         interval = "confidence", level = .80)
```

```
##        fit      lwr      upr
*## 1 30.72958 30.44099 31.01817
```

]

---
# Fator oferta minimiza o CV na RLM?

[App Fator Oferta 2](http://104.248.57.29/shiny/fatorOferta2/)

--

&lt;img src="images/unnamed-chunk-81-1.svg" style="display: block; margin: auto;" /&gt;


---
# Efeito da omissão de variáveis relevantes na estimação do fator oferta


```r
R&gt; set.seed(1)
R&gt; area &lt;- runif(200, min = 250, max = 5000)
R&gt; distancia &lt;- runif(200, min = 10, max = 500)
R&gt; venda &lt;- rbinom(200, 1, .5)
R&gt; lvu &lt;- 7.5 - .25*log(area) -.25*log(distancia) - .1625*venda + rnorm(200, mean = 0, sd = .05)
R&gt; dados &lt;- data.frame(VU = exp(lvu), Area = area, Distancia = distancia,
                  Fonte = factor(venda, labels = c("Oferta", "Venda")))
```

--


```r
R&gt; fitComplete &lt;- lm(log(VU) ~ log(Area) + log(Distancia) + Fonte, dados)
R&gt; fitOVB &lt;- lm(log(VU) ~ log(Area) + Fonte, dados)
```

---
# Efeito da omissão de variáveis relevantes na estimação do fator oferta

&lt;table style="border-collapse:collapse; border:none;"&gt;
&lt;tr&gt;
&lt;th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; "&gt;&amp;nbsp;&lt;/th&gt;
&lt;th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;log(VU)&lt;/th&gt;
&lt;th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;log(VU)&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; "&gt;Predictors&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;CI&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;p&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;CI&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  col7"&gt;p&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;(Intercept)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;7.52&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;7.42&amp;nbsp;&amp;ndash;&amp;nbsp;7.63&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;6.37&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;6.03&amp;nbsp;&amp;ndash;&amp;nbsp;6.70&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;Area [log]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.25&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.26&amp;nbsp;&amp;ndash;&amp;nbsp;-0.24&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.28&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.32&amp;nbsp;&amp;ndash;&amp;nbsp;-0.23&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;Distancia [log]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.26&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.27&amp;nbsp;&amp;ndash;&amp;nbsp;-0.24&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;Fonte [Venda]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.16&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.17&amp;nbsp;&amp;ndash;&amp;nbsp;-0.14&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.13&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.18&amp;nbsp;&amp;ndash;&amp;nbsp;-0.07&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;"&gt;Observations&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3"&gt;200&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3"&gt;200&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;"&gt;R&lt;sup&gt;2&lt;/sup&gt; / R&lt;sup&gt;2&lt;/sup&gt; adjusted&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;0.959 / 0.958&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;0.490 / 0.485&lt;/td&gt;
&lt;/tr&gt;

&lt;/table&gt;


--

* A estimativa central não muda muito, mesmo com o viés devido à omissão da variável;

--

* A eficiência da estimação, no entanto, é bem inferior à obtida com o modelo completo.

---
# Obtenção à partir da minimização das THSD



```r
R&gt; optimise(THSD, c(0.5, 2), tol = 0.0001, 
          data = dados, response = "VU", predictors = "log(Area)",
           factor = "Fonte", level = "Venda", transf = "log")
```

--


```
## $minimum
## [1] 0.8818589
## 
## $objective
## [1] 2.414254e-05
```

--


```r
R&gt; optimise(THSD, c(0.5, 2), tol = 0.0001, 
          data = dados, response = "VU", predictors = c("log(Area)", "log(Distancia)"),
           factor = "Fonte", level = "Venda", transf = "log")
```


--


```
## $minimum
## [1] 0.854978
## 
## $objective
## [1] 1.208746e-05
```

---
class: inverse, center, middle

# Estudo de caso

---
# Estudo de Caso

## Dados de Atibaia/SP &lt;a name=cite-mantovani2019&gt;&lt;/a&gt;([Mantovani, Cymrot, and Cappelano, ](#bib-mantovani2019))

&lt;img src="images/unnamed-chunk-85-1.svg" style="display: block; margin: auto;" /&gt;

---
# Estudo de Caso

## Análise Exploratória


&lt;img src="images/unnamed-chunk-86-1.svg" style="display: block; margin: auto;" /&gt;

---
# Ajuste de modelos


```r
R&gt; fitOferta &lt;- lm(log(VUoferta)~ log(IndiceFiscal) + log(AreaConstruida) + PC,
                 data = atibaia, subset = -60)
R&gt; 
R&gt; fitVenda &lt;- lm(log(VUvenda)~ log(IndiceFiscal) + log(AreaConstruida) + PC,
                data = atibaia, subset = -60)
```


---
# Resíduos Parciais

## Model de Oferta




&lt;img src="images/unnamed-chunk-89-1.svg" style="display: block; margin: auto;" /&gt;

---
# Resíduos Parciais

## Model de Venda




&lt;img src="images/unnamed-chunk-91-1.svg" style="display: block; margin: auto;" /&gt;

---

&lt;img src="images/unnamed-chunk-92-1.svg" style="display: block; margin: auto;" /&gt;

---

&lt;img src="images/unnamed-chunk-93-1.svg" style="display: block; margin: auto;" /&gt;

---
# Estimação do Fator Oferta

## Resumo

&lt;table style="border-collapse:collapse; border:none;"&gt;
&lt;tr&gt;
&lt;th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; "&gt;&amp;nbsp;&lt;/th&gt;
&lt;th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;log(VUoferta)&lt;/th&gt;
&lt;th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;log(VUvenda)&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; "&gt;Predictors&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;CI&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;p&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;CI&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  col7"&gt;p&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;(Intercept)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;9.83&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;9.08&amp;nbsp;&amp;ndash;&amp;nbsp;10.59&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;10.16&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;9.43&amp;nbsp;&amp;ndash;&amp;nbsp;10.90&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;IndiceFiscal [log]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;0.11&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;0.04&amp;nbsp;&amp;ndash;&amp;nbsp;0.18&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;0.003&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;0.10&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;0.03&amp;nbsp;&amp;ndash;&amp;nbsp;0.17&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;0.004&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;AreaConstruida [log]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.39&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.51&amp;nbsp;&amp;ndash;&amp;nbsp;-0.28&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.46&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.58&amp;nbsp;&amp;ndash;&amp;nbsp;-0.35&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;PC [Médio]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.39&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.51&amp;nbsp;&amp;ndash;&amp;nbsp;-0.26&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.39&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.51&amp;nbsp;&amp;ndash;&amp;nbsp;-0.27&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;PC [Simples]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.66&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;1.03&amp;nbsp;&amp;ndash;&amp;nbsp;-0.28&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.73&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;1.10&amp;nbsp;&amp;ndash;&amp;nbsp;-0.36&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;PC [Superior]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.38&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.56&amp;nbsp;&amp;ndash;&amp;nbsp;-0.20&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.35&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.52&amp;nbsp;&amp;ndash;&amp;nbsp;-0.17&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;strong&gt;&amp;lt;0.001&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;"&gt;Observations&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3"&gt;64&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3"&gt;64&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;"&gt;R&lt;sup&gt;2&lt;/sup&gt; / R&lt;sup&gt;2&lt;/sup&gt; adjusted&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;0.535 / 0.495&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;0.595 / 0.560&lt;/td&gt;
&lt;/tr&gt;

&lt;/table&gt;

--

### E agora? Como estimar o fator oferta???

---
# Estimação do Fator Oferta



```
## Linear hypothesis test
## 
## Hypothesis:
## log(IndiceFiscal) = 0.1
## log(AreaConstruida) = - 0.46
## 
## Model 1: restricted model
## Model 2: log(VUoferta) ~ log(IndiceFiscal) + log(AreaConstruida) + PC
## 
##   Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
## 1     60 1.4331                           
## 2     58 1.3995  2  0.033616 0.6966 0.5024
```

--

## Modelos restritos



```r
R&gt; RfitVenda &lt;- lm(log(VUvenda) ~ offset(.1*log(IndiceFiscal)) + offset(-.46*log(AreaConstruida)) +
                  PC, data = atibaia, subset = -60)
R&gt; RfitOferta &lt;- lm(log(VUoferta) ~ offset(.1*log(IndiceFiscal)) + offset(-.46*log(AreaConstruida)) +
                  PC, data = atibaia, subset = -60)
```

---
# Estimação do Fator Oferta

.pull-left[

&lt;table style="border-collapse:collapse; border:none;"&gt;
&lt;tr&gt;
&lt;th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; "&gt;&amp;nbsp;&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;Dependent variable&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;Dependent variable&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; "&gt;Predictors&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;(Intercept)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;10.157&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;10.262&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;PCMédio&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.387&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.431&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;PCSimples&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.725&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.773&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;PCSuperior&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.346&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.376&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;"&gt;Observations&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="1"&gt;64&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="1"&gt;64&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;"&gt;R&lt;sup&gt;2&lt;/sup&gt; / R&lt;sup&gt;2&lt;/sup&gt; adjusted&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="1"&gt;0.592 / 0.572&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="1"&gt;0.578 / 0.557&lt;/td&gt;
&lt;/tr&gt;

&lt;/table&gt;

* Padrão Fino:


```r
R&gt; exp(10.157 - 10.262)
```

```
## [1] 0.9003245
```

]

.pull-right[


* Padrão Médio:


```r
R&gt; exp((10.157 - .387) - (10.262 - .431))
```

```
## [1] 0.9408232
```

* Padrão Simples:


```r
R&gt; exp((10.157 - .725) - (10.262 - .773))
```

```
## [1] 0.9445941
```

* Padrão Superior:

```r
R&gt; exp((10.157 - .346) - (10.262 - .376))
```

```
## [1] 0.9277435
```

]

---
# Estimação do Fator Oferta

## Adoção dos coeficientes do modelo de oferta


```
## Linear hypothesis test
## 
## Hypothesis:
## log(IndiceFiscal) = 0.11
## log(AreaConstruida) = - 0.39
## 
## Model 1: restricted model
## Model 2: log(VUvenda) ~ log(IndiceFiscal) + log(AreaConstruida) + PC
## 
##   Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
## 1     60 1.3627                           
## 2     58 1.3234  2  0.039341 0.8621 0.4276
```

--
# Estimação do Fator Oferta

## Modelos restritos



```r
R&gt; RfitVenda2 &lt;- lm(log(VUvenda) ~ offset(.11*log(IndiceFiscal)) + offset(-.39*log(AreaConstruida)) +
                  PC, data = atibaia, subset = -60)
R&gt; RfitOferta2 &lt;- lm(log(VUoferta) ~ offset(.11*log(IndiceFiscal)) + offset(-.39*log(AreaConstruida)) +
                  PC, data = atibaia, subset = -60)
```

---
# Estimação do Fator Oferta

.pull-left[

&lt;table style="border-collapse:collapse; border:none;"&gt;
&lt;tr&gt;
&lt;th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; "&gt;&amp;nbsp;&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;Dependent variable&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;Dependent variable&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; "&gt;Predictors&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;(Intercept)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;9.707&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;9.812&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;PCMédio&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.341&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.384&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;PCSimples&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.602&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.649&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;PCSuperior&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.351&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&amp;#45;0.381&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;"&gt;Observations&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="1"&gt;64&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="1"&gt;64&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;"&gt;R&lt;sup&gt;2&lt;/sup&gt; / R&lt;sup&gt;2&lt;/sup&gt; adjusted&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="1"&gt;0.531 / 0.507&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="1"&gt;0.532 / 0.508&lt;/td&gt;
&lt;/tr&gt;

&lt;/table&gt;

* Padrão Fino:


```r
R&gt; exp(9.707 - 9.812)
```

```
## [1] 0.9003245
```

]

.pull-right[


* Padrão Médio:


```r
R&gt; exp((9.707 - .341) - (9.812 - .384))
```

```
## [1] 0.9398829
```

* Padrão Simples:


```r
R&gt; exp((9.707 - .602) - (9.812 - .649))
```

```
## [1] 0.9436499
```

* Padrão Superior:

```r
R&gt; exp((9.707 - .351) - (9.812 - .381))
```

```
## [1] 0.9277435
```

]

---
class: inverse, center, middle

# Efeitos do Fator Oferta sobre IC e IP


---
# Efeitos do Fator Oferta sobre IC e IP

`$$\mathbb{E}[c \cdot VU] = c\mathbb{E}[VU]$$`

--

`$$\mathbb{E}[VU_{venda}] = \mathbb{E}[c\cdot VU_{oferta}] = c \mathbb{E}[VU_{oferta}]$$`

--

`$$\mathbb{V}[c \cdot VU] = c^2\mathbb{V}[VU]$$`

--

`$$\mathbb{V}[VU_{venda}] = \mathbb{V}[c\cdot VU_{oferta}] = c^2 \mathbb{V}[VU_{oferta}]$$`

--

* Intervalos de Confiança &lt;a name=cite-matloff2009&gt;&lt;/a&gt;([Matloff, 2009](#bib-matloff2009)):

`$$IC_\alpha = \hat\theta \pm Z_{1 - \frac{\alpha}{2}} s.e.(\hat \theta)$$`
--

* `\(s.e.(\hat \theta) = \frac{s}{\sqrt{n}} \, , \text{onde} \, s\, \text{é o desvio-padrão amostral}\)`

* `\(\mathbb{\hat V}(\hat \theta) = \frac{s^2}{n}\)`

* `\(s.e.(\hat \theta) = \sqrt{\mathbb{\hat V}(\hat \theta)}\)`

---
# Efeitos do Fator Oferta sobre IC e IP

* `\(s.e.(\hat{VU}_{venda}) = s.e.(c \hat{VU}_{oferta}) = \sqrt{\mathbb{\hat V}(c \hat{VU}_{oferta})}\)`

--

* `\(s.e.(\hat{VU}_{venda}) = \sqrt{c^2\mathbb{\hat V} (\hat{VU}_{oferta})}\)`

--

* `\(s.e.(\hat{VU}_{venda}) = c\sqrt{\mathbb{\hat V} (\hat{VU}_{oferta})} = c\cdot s.e.(\hat{VU}_{oferta})\)`

--

* O IC dos valores de venda, portanto, pode ser escrito assim:

`$$IC_{VU_{venda}} = \hat{VU}_{venda} \pm Z_{1 - \frac{\alpha}{2}} s.e.(\hat{VU}_{venda})$$`

--
* Ou assim:

`$$IC_{VU_{venda}} = c \cdot \hat{VU}_{oferta} \pm Z_{1 - \frac{\alpha}{2}} \cdot c \cdot s.e.(\hat{VU}_{oferta})$$`

--

* Em suma:

`$$IC_{VU_{venda}} = c \cdot IC_{VU_{oferta}}$$`

---
# Efeitos do Fator Oferta sobre IC e IP

* Dados exclusivamente de ofertas:


```r
R&gt; set.seed(2)
R&gt; area &lt;- runif(100, min = 250, max = 10000); vu &lt;- 3000 - .25*area + rnorm(100, 0, 2000)
R&gt; dados &lt;- data.frame(VU = vu, Area = area)
```

--


.pull-left[

* Avaliador A:


```r
R&gt; dados$VUvenda &lt;- .9*dados$VU
R&gt; fit &lt;- lm(VUvenda ~ Area, data = dados)
R&gt; p &lt;- predict(fit, 
         newdata = data.frame(Area = 5000),
         interval = "confidence", level = .80)
R&gt; p
```

```
##        fit      lwr      upr
*## 1 1618.635 1357.652 1879.617
```

]

.pull-right[

* Avaliador B:


```r
R&gt; fit1 &lt;- lm(VU ~ Area, data = dados)
R&gt; p1 &lt;- predict(fit1, 
             newdata = data.frame(Area = 5000),
             interval = "confidence", level = .80)
R&gt; p1
```

```
##        fit      lwr      upr
## 1 1798.483 1508.503 2088.463
```

```r
R&gt; .9*p1
```

```
##        fit      lwr      upr
*## 1 1618.635 1357.652 1879.617
```


]

---
class: inverse, center, middle

# Conclusão

---
# Conclusão

* A estimação e aplicação do Fator Oferta deve ser feita com cuidado. 
  - Deve-se ter em mente que assumir que `\(V_{venda} = \lambda V_{oferta}\)` é 
  apenas uma hipótese, que deve ser verificada.
  
--

* A análise exploratória é fundamental para a percepção da realidade do mercado
antes da modelagem.

--

* A modelagem deve levar em conta a hipótese feita para o fator oferta.
  - A má especificação do fator oferta pode levar a modelos tendenciosos, que 
podem produzir más previsões de valores, especialmente nos extremos da amostra.

--

* A eventual obtenção do fator oferta previamente à modelagem é benéfica.
  - Modelos ficam mais simples e interpretáveis.

--
  
* Quando possível, deve ser investigada a possível existência de fatores 
diferentes, de acordo com a tipologia, o padrão construtivo, etc.

--

* A transformação logarítimica da variável dependente permite
uma estimação menos custosa do fator oferta.

---
# Conclusão

* Quando da utilização exclusiva de dados de oferta, a aplicação do fator oferta
antes ou após o ajuste do modelo de regressão deveria conduzir aos mesmos
valores previstos, tanto para a estimativa central, quanto para os limites dos
intervalos de confiança e predição. A norma deveria estabelecer este 
procedimento explicitamente.

---
class: scrollable-slide

# Referências

&lt;a name=bib-NBR1465302&gt;&lt;/a&gt;[ABNT](#cite-NBR1465302) (2011). _NBR
14653-2. Avaliacao de Bens - Parte 2: Imoveis Urbanos_. Associacao
Brasileira de Normas Tecnicas. Rio de Janeiro, p. 51.

&lt;a name=bib-NBR1465301&gt;&lt;/a&gt;[ABNT](#cite-NBR1465301) (2019). _NBR
14653-1. Avaliacao de Bens - Parte 1: Procedimentos Gerais_. Associacao
Brasileira de Normas Tecnicas. Rio de Janeiro, p. 19.

&lt;a name=bib-chinloy&gt;&lt;/a&gt;[Chinloy, P. T.](#cite-chinloy) (1980). "An
empirical model of the market for resale homes". In: _Journal of Urban
Economics_ 7.3, pp. 279-292. ISSN: 0094-1190. DOI:
[https://doi.org/10.1016/0094-1190(80)90001-7](https://doi.org/https%3A%2F%2Fdoi.org%2F10.1016%2F0094-1190%2880%2990001-7).

&lt;a name=bib-erba2019&gt;&lt;/a&gt;[Erba, D. A.](#cite-erba2019) (2019).
"Politica Tributaria vs. Politica Catastral, nuevo juego de roles". In:
_Revista de Administracion Tributaria_, pp. 37-50. ISSN: 1684-9434.

&lt;a name=bib-haurin&gt;&lt;/a&gt;[Haurin, D., S. McGreal, A. Adair, et
al.](#cite-haurin) (2013). "List price and sales prices of residential
properties during booms and busts". In: _Journal of Housing Economics_
22.1, pp. 1-10. ISSN: 1051-1377. DOI:
[https://doi.org/10.1016/j.jhe.2013.01.003](https://doi.org/https%3A%2F%2Fdoi.org%2F10.1016%2Fj.jhe.2013.01.003).

&lt;a name=bib-horowitz&gt;&lt;/a&gt;[Horowitz, J. L.](#cite-horowitz) (1992). "The
Role of the List Price in Housing Markets: Theory and an Econometric
Model". In: _Journal of Applied Econometrics_ 7.2, pp. 115-129. ISSN:
08837252, 10991255. URL:
[http://www.jstor.org/stable/2285023](http://www.jstor.org/stable/2285023).

&lt;a name=bib-ibapeSP&gt;&lt;/a&gt;[IBAPE/SP](#cite-ibapeSP) (2011). _Norma Para
Avaliacao de Imoveis Urbanos_. Instituto Brasileiro de Avaliacoes e
Pericias de Engenharia de Sao Paulo. Sao Paulo, p. 36.

&lt;a name=bib-lima2006&gt;&lt;/a&gt;[Lima, G. P. d. A.](#cite-lima2006) (2006).
"Homogeneizacao por Fatores na Forma Aditiva, Multiplicativa ou Mista?"
In: _XIII COBREAP_.

&lt;a name=bib-mantovani2019&gt;&lt;/a&gt;[Mantovani, F. A., R. Cymrot, and L. H.
Cappelano](#cite-mantovani2019) "Fator Oferta para imoveis residenciais
da cidade de Atibaia/SP em tempos de crise". In: _XX COBREAP_.

&lt;a name=bib-matloff2009&gt;&lt;/a&gt;[Matloff, N. S.](#cite-matloff2009) (2009).
_From Algorithms to Z-Scores. Probabilistic and Statistical Modeling in
Computer Science_. Davis, California: Orange Grove Books. URL:
[http://heather.cs.ucdavis.edu/~matloff/132/PLN/probstatbook/ProbStatBook.pdf](http://heather.cs.ucdavis.edu/~matloff/132/PLN/probstatbook/ProbStatBook.pdf).

&lt;a name=bib-mooya2009&gt;&lt;/a&gt;[Mooya, M. M.](#cite-mooya2009) (2009).
"Market Value without a Market: Perspectives from Transaction Cost
Theory". In: _Urban Studies_ 46.3, pp. 687-701. ISSN: 00420980,
1360063X. URL:
[http://www.jstor.org/stable/43197982](http://www.jstor.org/stable/43197982).

&lt;a name=bib-spinney&gt;&lt;/a&gt;[Spinney, J. E. L.](#cite-spinney) (2010).
"Geography, Land Values and Municipal Taxation. A Spatial Paradigm for
the estimation and reclamation of rent". Doctor of Philosophy.
Hamilton, Ontario, p. 132.


---
class: center, middle, inverse

# OBRIGADO!
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
